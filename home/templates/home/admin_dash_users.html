{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="flex-container product-details-flex-container">

    {% include 'includes/side-nav.html' %}

    <div class="container-fluid col-12 col-md-8">
        <header class="details-page-header d-flex flex-column">
            <div class="container">
                <h1 class="details-page-heading">All Users</h1>
                <h2 class="details-page-subheading mb-4">Here are all of Lionize's Users. Any messages sent by the user to Lionize are also listed below.
                    You can also use the search bar below to filter by name or username.
                </h2>
            </div>
        </header>

        <section class="container-fluid col-12 col-md-8">
            <div class="details-page-header d-flex flex-column">
                <div class="container">
                    <form method="GET" action="{% url 'admin-dash-users' %}">
                        <div class="input-group 1-100">
                            <input class="form-control" type="text" name="q" placeholder="Search for User" value="{% if search_term %}{{search_term}}{% else %}{% endif %}">
                            <div class="input-group-append">
                                <button class="button button-accent" type="submit">
                                    <span class="icon">
                                        <i class="fas fa-search"></i>
                                    </span>
                                </button>
                                <a class="button button-accent" href="{% url 'admin-dash-users'%}">
                                    <span class="icon">
                                        <i class="fas fa-undo-alt"></i>
                                    </span>
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
<section class="user-listing">
            <div class="row">

                {% for user in user_profiles %}
                    <div class="col-12">
                        <div class="card m-4">
                            <div class="card-body d-flex flex-column flex-md-row m-2">
                                <div class="user-details card-details m-2 p-3">
                                    <h5 class="divider">User Details:</h5>
                                    <p class="card-title"><strong>Username: </strong>{{user.user.username}}</p>
                                    {% if user.user.first_name %}
                                        <p><strong>Name: </strong>{{user.user.first_name}} {{user.user.last_name}}</strong></p>
                                    {% endif %}
                                    {% if user.default_phone_number %}
                                        <p class=""><strong>Phone:</strong>  {{user.default_phone_number}}</p>
                                    {% endif %}
                                    <p class=""><strong>Email:</strong>  {{user.user.email}}</p>
                                    {% if user.consultation %}
                                        <p class=" text-muted"><strong>Free Consultation Done?</strong>  Yes</p>
                                    {% else %}
                                        <p class=" text-muted"><strong>Free Consultation Done?</strong>  No</p>
                                    {% endif %}
                                </div>
                                <div class="message-details m-2 p-3">
                                <h5>Messages:</h5>
                                {% for message in user_messages %}
                                    {% if message.user == user %}
                                        <div class="message-list-container">
                                            <p><strong>Subject:</strong> {{message.subject}}</p>
                                            <p><strong>Message:</strong> {{message.message}}</p>
                                            <p class="text-muted mb-2"><strong>Date Sent:</strong> {{message.date}}</p>
                                            <p class="text-muted mb-2"><strong>Resolved:</strong> {{message.resolved}}</p>
                                        </div>
                                    {% endif %}
                                {% endfor %}  
                            </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
    </section>
        
    </div>

</div>
{% endblock %}